{% extends "portal/base.html" %}


{% block breadcrumb %}
<i class="fas fa-home"></i><span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item">Técnicos</span>
{% endblock %}

{% block styles %}
    {{ super() }}
    <style>
        /* DESIGN LIMPO E MODERNO */
        :root {
            --cor-ativo: #28a745;
            --cor-inativo: #dc3545;
            --cor-fundo: #f8f9fa;
        }

        .painel-filtros {
            background: #1F1F23;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .05);
            margin-bottom: 2rem;
            border-left: 5px solid #007bff;
        }

        .controles-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .input-pesquisa {
            flex: 1;
            color: white;
            padding: .7rem;
            border: 1px solid #00C3FF;
            border-radius: 4px;
            min-width: 200px;
            background: #0A1F44;
        }
        .input-pesquisa::placeholder {
            color: white;
        }

        .btn-filtro {
            padding: 0.7rem 1.5rem;
            border: 1px solid #ddd;
            background: #f1f1f1;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-filtro:hover { background: #e2e6ea; }

        .btn-filtro.ativo {
            background: #4C3AFF;
            color: #fff;
            border-color: #FFFFFF;
        }

        /* GRID DE CARDS */
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card-tech {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            transition: transform 0.2s;
            border-top: 4px solid #ccc;
        }

        .card-tech:hover { transform: translateY(-5px); }

        .card-tech[data-status="ativo"] { border-top-color: #00F5B5; }
        .card-tech[data-status="inativo"] { border-top-color: #FFC93C; }

        .tech-info h4 { margin: 0 0 5px 0; color: #333; }
        .tech-info p { margin: 0; color: #666; font-size: 0.9rem; }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
        }
        
        .bg-ativo { background: #00F5B5; color: #0B0B0D; }
        .bg-inativo { background: #FFC93C; color: #0B0B0D; }

        .stats-area {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .stat-box { text-align: center; }
        .stat-num { display: block; font-size: 1.2rem; font-weight: bold; color: #333; }
        .stat-desc { font-size: 0.7rem; text-transform: uppercase; color: #888; }

    </style>
{% endblock %}

{% block content %}

<div class="painel-filtros">
    <div style="margin-bottom: 10px; font-weight: bold; color: white;">
        <i class="fas fa-sliders-h"></i> Filtrar Técnicos:
    </div>
    <div class="controles-wrapper">
        <input type="text" id="campoBusca" class="input-pesquisa" placeholder="Nome ou email...">
        
        <button id="btnTodos" class="btn-filtro ativo">Todos</button>
        <button id="btnAtivos" class="btn-filtro">Ativos</button>
        <button id="btnInativos" class="btn-filtro">Inativos</button>
    </div>
    <div style="margin-top: 10px; font-size: 0.9rem; color: white;">
        Exibindo <span id="contador">0</span> técnicos
    </div>
</div>

<div class="grid-cards" id="containerGrid">
    {% for tech in technicians %}
    {% set st = 'inativo' if tech.no_activity else 'ativo' %}
    
    <div class="card-tech" 
         data-status="{{ st }}" 
         data-search="{{ tech.name }} {{ tech.email }} {{ tech.upn }}">
        
        <div class="tech-info">
            <h4>{{ tech.name or tech.upn }}</h4>
            <p>{{ tech.email or tech.upn }}</p>
            
            {% if tech.no_activity %}
                <span class="status-badge bg-inativo">Inativo</span>
            {% else %}
                <span class="status-badge bg-ativo">Ativo</span>
            {% endif %}
        </div>

        <div class="stats-area">
            <div class="stat-box">
                <span class="stat-num">{{ tech.user_coolers_read }}</span>
                <span class="stat-desc">Coolers</span>
            </div>
            <div class="stat-box">
                <span class="stat-num">{{ tech.ghost_read }}</span>
                <span class="stat-desc">Ghosts</span>
            </div>
            <div class="stat-box">
                <span class="stat-num" style="color: #007bff;">{{ tech.total_activity }}</span>
                <span class="stat-desc">Total</span>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div id="avisoZero" style="display: none; text-align: center; padding: 3rem; color: #999;">
    <h3>Nenhum resultado encontrado</h3>
</div>

<script>
    (function() {

        // Elementos
        const inputBusca = document.getElementById('campoBusca');
        const btnTodos = document.getElementById('btnTodos');
        const btnAtivos = document.getElementById('btnAtivos');
        const btnInativos = document.getElementById('btnInativos');
        const cards = document.querySelectorAll('.card-tech');
        const contadorEl = document.getElementById('contador');
        const avisoEl = document.getElementById('avisoZero');
        const gridEl = document.getElementById('containerGrid');

        // Estado
        let filtroAtual = 'todos';
        let textoAtual = '';

        // Função Principal
        function filtrar() {
            let visiveis = 0;
            const termo = textoAtual.toLowerCase();

            cards.forEach(card => {
                const statusCard = card.getAttribute('data-status');
                const textoCard = (card.getAttribute('data-search') || '').toLowerCase();

                // Checa Status
                let statusOk = false;
                if (filtroAtual === 'todos') statusOk = true;
                else if (filtroAtual === statusCard) statusOk = true;

                // Checa Texto
                let textoOk = false;
                if (termo === '' || textoCard.includes(termo)) textoOk = true;

                // Aplica
                if (statusOk && textoOk) {
                    card.style.display = 'block';
                    visiveis++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Atualiza Interface
            contadorEl.innerText = visiveis;
            
            if (visiveis === 0) {
                gridEl.style.display = 'none';
                avisoEl.style.display = 'block';
            } else {
                gridEl.style.display = 'grid';
                avisoEl.style.display = 'none';
            }
        }

        // Eventos de Clique (Substituindo onclick)
        function setFiltro(tipo, btnClicado) {
            filtroAtual = tipo;
            // Limpa classes
            [btnTodos, btnAtivos, btnInativos].forEach(b => b.classList.remove('ativo'));
            // Ativa clicado
            btnClicado.classList.add('ativo');
            filtrar();
        }

        if(btnTodos) btnTodos.addEventListener('click', function() { setFiltro('todos', this); });
        if(btnAtivos) btnAtivos.addEventListener('click', function() { setFiltro('ativo', this); });
        if(btnInativos) btnInativos.addEventListener('click', function() { setFiltro('inativo', this); });

        // Evento de Busca
        if(inputBusca) {
            inputBusca.addEventListener('keyup', function(e) {
                textoAtual = e.target.value;
                filtrar();
            });
        }

        // Inicializa contagem
        filtrar();

    })(); // Executa imediatamente
</script>

{% endblock %}